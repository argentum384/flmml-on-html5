"use strict";var FlMMLPlayer=function(t){function i(t){for(var i;i=t.lastChild;)t.removeChild(i)}function e(){var i,e,n,l,a;e=t.createElement("button"),i=e.style,i.margin="0",i.position="relative",i.width=i.height="20px",i.visibility="hidden",n=t.createElement("div"),i=n.style,i.position="absolute",i.left=i.top="0",i.width=i.height="20px",e.appendChild(n),t.body.appendChild(e),l=e.getBoundingClientRect(),a=n.getBoundingClientRect(),s=l.left-a.left,o=l.top-a.top,t.body.removeChild(e)}function n(i){var n;if(i.mmlURL&&""!==i.mmlURL){var A=this.xhr=new XMLHttpRequest;A.addEventListener("readystatechange",this.onReadyStateChange.bind(this)),A.open("GET",i.mmlURL),A.send(null),this.mmlStatus=a}else this.mml=i.mml,this.mmlStatus=l;(void 0===s||void 0===o)&&e();var h=this.divContainer=t.createElement("div");if(n=h.style,n.display="inline-block",n.position="relative",n.left=n.top="0",n.width="128px",n.height="20px",n.color="black",n.textAlign="center",n.fontSize="12px",n.fontFamily="'Arial', sans-serif",n.zIndex="0",n.boxSizing="border-box",this.mmlStatus===a){n.backgroundColor=p,n.border=d;var m=this.divSysMsg=t.createElement("div");n=m.style,n.marginLeft=n.marginRight="-1px",n.marginTop="-0.5em",n.position="absolute",n.top="9px",n.width="128px",m.appendChild(t.createTextNode("Loading...")),h.appendChild(m)}else n.backgroundColor="transparent";var r=this.btnPlayPause=t.createElement("button");n=r.style,n.margin="0",n.position="absolute",n.left=n.top="0",n.width=n.height="20px",r.addEventListener("click",this.onPlayPause.bind(this));var g=this.btnPlayMML=r.cloneNode();g.style.width="128px",g.addEventListener("click",this.onPlayFirst.bind(this));var u=this.btnStop=r.cloneNode();u.style.left="20px",u.addEventListener("click",this.onStop.bind(this));var f=this.btnVolume=r.cloneNode();f.style.left="",f.style.right="0",f.addEventListener("click",this.onVolume.bind(this));var v=this.imgPause=t.createElement("img");v.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAUVBMVEUAgf8Agv0AdvwAf/0AgP8Afv4AgPsAgP8Akf8Af/8AfvwAfv8Af/8AffoAfv8Af/0Afv8Agf8AgP0AgP8Agf8Agv8AgP0Aff0Agf8Afv8Af/5GU6gfAAAAGnRSTlMQCgZFLxwVDAJfQDgqHhigJyOWiFErdnZZWQOnFfsAAACjSURBVBjTbZFLDsMgDERtEzDhl5Bv2/sftDaq2i48i5H8JMwwQIxEyPARI1GMIIwheO9rFQvARAo5+H5OQ2f3gQUSgi85uaGUSwUkIGhrfonmWT2vTRBCnZyO963upioIQ8+HjvuufuQeFK7pqeO2qT/SKpBbSWPbsozNqTQGbMX9Q1caWtA+bl1kR/qFv65vePOZZiFmdQJxlFxFo2SkaH7HG2/2EtuThcAOAAAAAElFTkSuQmCC",n=v.style,n.marginLeft=n.marginRight=s+"px",n.marginTop=n.marginBottom=o+"px",n.position="absolute",n.left=n.top="0",n.width=n.height="20px";var y=this.imgPlay=v.cloneNode();y.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAASFBMVEUAAAAAmgAAlQAAlwAAmAAAmQAAmgAAlwAAmwAAmQAAmQAAmQAAmAAAmQAAmQAAmAAAlwAAmQAAmQAAmAAAlwAAmQAAmQAAmADD6lrGAAAAF3RSTlMABwQKGRUNJRE5IC9UKkRqYE9ANXNkRrSOT5UAAACQSURBVBjTbZFbEsMgCEV9oIivxKQt+99p0cm0fnA+z1xHuBjjrPWCtc6ZB3E+phBSiv6vrU+QETHDpsVhIaK7ZQiil42AN3Oto1NBSa9wyqWzcJy1U8shzmxAqrx4neMqy4q8Tn446rTeGmj9zT8GNYhTfg7eKJBUqT9XP1JH0oZX11QL2atbyu0lh71k9Rxfym0PdbeElC0AAAAASUVORK5CYII=",y.style.left="25px";var c=this.imgStop=v.cloneNode();c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAPFBMVEX+AD7/AD//AED/AEn+AD//AD/+AD/+AEH/ADn9ADv/AE3+AD79AD7/AD7/AED+AD7/AED8AD7/AD7+AD9mm+jzAAAAE3RSTlMqFhIIaUY9Hw0ZA1lOQjQmLWNiJUEu2wAAAINJREFUGNNtkUsOwzAIRMdgg/920vvftSiL1lJ47J6EgAG1Mmei8ECUmWtFNVV04WFpMV3BOSimjGQMmdCQGUy6pbcrGlfrspUYuUA+B4KSQTr7KftUAi1pp2yyCAHjPuU9EKxSPGVMpspbFle67e4gdyV3efdMNxA3un/Ie/9Cdt/xBc2vEO2zvZ1rAAAAAElFTkSuQmCC";var b=this.imgVolume=v.cloneNode();b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAS1BMVEV+fgB+fgB9fQB+fgB+fgCAgAB+fgB+fgB5eQB+fgB/fwCAgACPjwB+fgB9fQB8fAB9fQCIiAB+fgB+fgB9fQB+fgB/fwCAgAB+fgDkkneCAAAAGHRSTlMVLykkHRlGNg47IQoEXU0RPwd8aVVRhT4xQnacAAAAkklEQVQY04XR2w7DIAgGYASVauthW7vx/k+6v+mW7IJk3PkFEJG2bbuty6AUq4jUmGhZgTCQcEAYVyjBkFY5aJnTLEAHnRYl6Cv3w8xKkESEWljJfW+GyMqR6GNHe9gZfSIVWFlxusz2rMCRJEyc7hc21KNpZM0/2AuafvH5D91y7yJ/JHd495nuQtzVuUt2v+MNB6QSU7F5AiUAAAAASUVORK5CYII=";var C=this.divDisplay=t.createElement("div");n=C.style,n.position="absolute",n.left="40px",n.top="0",n.width="68px",n.height="20px",n.backgroundColor=p,n.boxSizing="border-box",n.border=d;var S=this.divStatus=t.createElement("div");n=S.style,n.marginLeft=n.marginRight="-1px",n.marginTop="-0.5em",n.position="absolute",n.top="9px",n.width="68px",n.fontSize="10px";var x=this.divPlayMML=t.createElement("div");n=x.style,n.marginLeft=n.marginRight=s+"px",n.marginTop="-0.5em",n.position="absolute",n.left="45px",n.top="50%",n.fontSize="12px",x.appendChild(t.createTextNode("Play MML"));var E=this.divVolume=t.createElement("div");n=E.style,n.position="absolute",n.width="88px",n.visibility="hidden",n.backgroundColor=p,n.boxSizing="border-box",n.border=d,n.zIndex="1";var V=this.rangeVolume=t.createElement("input");V.type="range",V.defaultValue=void 0===i.volume?"100":i.volume+"",V.min="0",V.max="127",V.step="1",n=V.style,n.marginLeft=n.marginRight="0",n.marginTop=n.marginBottom="-1px",n.padding="0",n.left=n.top="0",n.position="absolute",n.width="86px",V.addEventListener("input",this.onInput.bind(this)),g.appendChild(y),g.appendChild(x),r.appendChild(v),u.appendChild(c),f.appendChild(b),C.appendChild(S),this.mmlStatus===l&&h.appendChild(g),E.appendChild(V);var B=t.getElementsByTagName("script"),P=B[B.length-1].parentNode;P.appendChild(h),P.appendChild(E);var M=this.flmml=new FlMMLonHTML5(i.workerURL);M.addEventListener("compilecomplete",this.onCompileComplete.bind(this)),M.addEventListener("buffering",this.onBuffering.bind(this)),M.addEventListener("complete",this.onComplete.bind(this)),M.addEventListener("syncinfo",this.onSyncInfo.bind(this)),void 0!==i.volume&&M.setMasterVolume(i.volume)}var s,o,l=1,a=2,A=3,h=4,p="RGBA(255,255,255,0.6)",d="1px inset RGBA(255,255,255,0.8)";return n.prototype.changeStatus=function(e){i(this.divStatus),this.divStatus.appendChild(t.createTextNode(e))},n.prototype.showVolume=function(){this.changeStatus("Volume:"+this.rangeVolume.value),this.isDispVol=!0,clearTimeout(this.tIDDispVol),this.tIDDispVol=setTimeout(this.onDispVolTimer.bind(this),2e3)},n.prototype.onReadyStateChange=function(e){if(this.xhr.readyState===XMLHttpRequest.DONE)if(i(this.divSysMsg),200===this.xhr.status){i(this.divContainer);var n=this.divContainer.style;n.backgroundColor="transparent",n.border="",this.divContainer.appendChild(this.btnPlayMML),this.mml=this.xhr.responseText,this.mmlStatus=A}else this.divSysMsg.appendChild(t.createTextNode("Can't load the file.")),this.flmml=null,this.mmlStatus=h},n.prototype.onPlayFirst=function(){var t=this.divContainer;t.removeChild(this.btnPlayMML),this.btnPlayMML.removeChild(this.imgPlay),this.imgPlay.style.left="0",this.changeStatus("Compiling..."),t.appendChild(this.btnPlayPause),t.appendChild(this.btnStop),t.appendChild(this.divDisplay),t.appendChild(this.btnVolume),this.flmml.play(this.mml)},n.prototype.onPlayPause=function(){i(this.btnPlayPause),this.flmml.isPlaying()?(this.btnPlayPause.appendChild(this.imgPlay),this.flmml.pause()):(this.btnPlayPause.appendChild(this.imgPause),this.flmml.isPaused()||(this.isCompiling=!0,this.changeStatus("Compiling...")),this.flmml.play(this.mml)),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onStop=function(){i(this.btnPlayPause),this.btnPlayPause.appendChild(this.imgPlay),this.btnStop.disabled="disabled",this.imgStop.style.opacity="0.4",this.flmml.stop(),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onVolume=function(){var t,i,e,n;t=this.divVolume.style,"hidden"===t.visibility?(t.left=t.top="0",i=this.divContainer.getBoundingClientRect(),e=this.divVolume.getBoundingClientRect(),n=this.rangeVolume.getBoundingClientRect(),t.left=(i.left-e.left+40).toFixed(1)+"px",t.top=(i.top-e.top+20).toFixed(1)+"px",t.height=(n.bottom-n.top).toFixed(1)+"px",t.visibility="visible",this.showVolume()):"visible"===t.visibility&&(t.visibility="hidden")},n.prototype.onInput=function(){this.flmml.setMasterVolume(parseInt(this.rangeVolume.value)),this.showVolume()},n.prototype.onCompileComplete=function(){this.btnStop.disabled="",this.imgStop.style.opacity="1.0",this.isCompiling=!1},n.prototype.onBuffering=function(t){100===t.progress?this.isBuffering=!1:(this.changeStatus("Buffering:"+t.progress+"%"),this.isBuffering=!0)},n.prototype.onComplete=function(){i(this.btnPlayPause),btnPlayPause.appendChild(this.imgPlay),this.btnStop.disabled="disabled",this.imgStop.style.opacity="0.4",clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onSyncInfo=function(){this.isDispVol||this.isCompiling||this.isBuffering||this.changeStatus(this.flmml.getNowTimeStr()+"/"+this.flmml.getTotalTimeStr())},n.prototype.onDispVolTimer=function(){this.isDispVol=!1,this.onSyncInfo()},n}(document);