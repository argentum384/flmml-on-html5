"use strict";var FlMMLPlayer=function(t){function e(t){for(var e;e=t.lastChild;)t.removeChild(e)}function i(t){1&t.buttons&&t.preventDefault()}function s(e){return t.createElementNS("http://www.w3.org/2000/svg",e)}function l(t,e){for(var i in e)t.setAttributeNS(null,i,e[i])}function n(e){var n=d.length;this.workerURL=e.workerURL,e.mmlURL&&""!==e.mmlURL?(this.mmlURL=e.mmlURL,this.mmlStatus=a):(this.mml=e.mml,this.mmlStatus=o);var h=void 0===e.hue?200:e.hue;this.volume=void 0===e.volume?100:e.volume,this.logVolume=!!e.logVolume;var r=this.svg=s("svg");l(r,{id:"FlMMLPlayer"+n,viewBox:"0 0 600 100"}),r.style.height=e.height?e.height:"1.5em",r.addEventListener("mousedown",i),r.addEventListener("mousemove",i);var p=t.createElement("style");p.setAttribute("type","text/css"),p.appendChild(t.createTextNode("\r\nsvg#FlMMLPlayer"+n+" .button:active{fill:url(#gradBtnPushed"+n+");}\r\nsvg#FlMMLPlayer"+n+" .button:hover{stroke:hsl("+h+",100%,75%)}\r\nsvg#FlMMLPlayer"+n+" text{text-anchor:middle;pointer-events:none}\r\n")),r.appendChild(p);var u=s("defs"),y=s("filter"),c=s("feGaussianBlur"),g=s("feMerge"),m=s("feMergeNode"),f=s("feMergeNode");l(y,{id:"filterGlow"+n,x:"-150%",y:"-100%",width:"600%",height:"400%"}),l(c,{"in":"SourceGraphic",stdDeviation:8,result:"blur"}),m.setAttributeNS(null,"in","blur"),f.setAttributeNS(null,"in","SourceGraphic"),g.appendChild(m),g.appendChild(f),y.appendChild(c),y.appendChild(g),u.appendChild(y);var v=s("linearGradient"),C=s("linearGradient"),S=s("stop"),x=s("stop");l(v,{id:"gradBtn"+n,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),l(S,{offset:0,"stop-color":"hsl("+h+",30%,98%)"}),l(x,{offset:1,"stop-color":"hsl("+h+",30%,83%)"}),v.appendChild(S),v.appendChild(x),l(C,{id:"gradBtnPushed"+n,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),x=x.cloneNode(),S=S.cloneNode(),x.setAttributeNS(null,"offset",0),S.setAttributeNS(null,"offset",1),C.appendChild(x),C.appendChild(S),u.appendChild(v),u.appendChild(C);var P=s("linearGradient"),D=s("stop"),V=s("stop");l(P,{id:"gradDisp"+n,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),l(D,{offset:0,"stop-color":"hsl("+h+",100%,2%)"}),l(V,{offset:1,"stop-color":"hsl("+h+",100%,30%)"}),P.appendChild(D),P.appendChild(V),u.appendChild(P),r.appendChild(u);var w=this.gPlayFirst=s("g"),b=this.gPlay=s("g"),L=this.gPlayD=s("g"),M=this.gPause=s("g"),N=this.gStop=s("g"),T=this.gDisplay=s("g"),E=this.gVolume=s("g");w.addEventListener("click",this.onPlayFirst.bind(this)),b.addEventListener("click",this.onPlayPause.bind(this)),M.addEventListener("click",this.onPlayPause.bind(this)),N.setAttributeNS(null,"transform","translate(100,0)"),N.addEventListener("click",this.onStop.bind(this));var F=this.gStopD=N.cloneNode(),B=s("rect");l(B,{x:5,y:5,width:90,height:90,rx:6,ry:6,fill:"url(#gradBtn"+n+")",stroke:"hsl("+h+",15%,50%)","stroke-width":4,"class":"button"}),b.appendChild(B.cloneNode()),M.appendChild(B.cloneNode()),N.appendChild(B.cloneNode());var k=B.cloneNode();l(k,{stroke:"hsl("+h+",15%,75%)","class":""}),L.appendChild(k.cloneNode()),F.appendChild(k.cloneNode()),B.setAttributeNS(null,"width",590),w.appendChild(B.cloneNode());var G=s("path");l(G,{fill:"hsl(120,100%,35%)",d:"M22,22v56l56,-28z",filter:"url(#filterGlow"+n+")","pointer-events":"none"}),b.appendChild(G);var A=G.cloneNode();l(A,{fill:"gray",opacity:.5}),L.appendChild(A);var R=s("rect");l(R,{x:26,y:22,width:17,height:56,fill:"hsl(210,100%,50%)",filter:"url(#filterGlow"+n+")","pointer-events":"none"});var U=R.cloneNode();U.setAttributeNS(null,"x",57),M.appendChild(R),M.appendChild(U);var I=s("rect");l(I,{x:23,y:23,width:54,height:54,fill:"hsl(15,100%,50%)",filter:"url(#filterGlow"+n+")","pointer-events":"none"}),N.appendChild(I);var O=I.cloneNode();l(O,{fill:"gray",opacity:.5}),F.appendChild(O);var X=s("text");l(X,{x:345,y:72,"font-family":"'Verdana'","font-size":62,textLength:280}),X.appendChild(t.createTextNode("Play MML")),w.appendChild(X),G=G.cloneNode(),G.setAttributeNS(null,"transform","translate(115,0)"),w.appendChild(G),r.appendChild(w);var j=s("rect");l(j,{x:203,y:5,width:394,height:44,rx:6,ry:6,fill:"url(#gradDisp"+n+")",stroke:"hsl("+h+",100%,30%)","stroke-width":4,"pointer-events":"none"}),T.appendChild(j);var z=this.textDisplay=s("text");l(z,{x:401,y:43,fill:"white","font-family":"'Courier New'","font-weight":"bold","font-size":50}),T.appendChild(z);var Y=s("rect");l(Y,{x:205,y:70,width:390,height:12,rx:4,ry:4,fill:"url(#gradBtnPushed"+n+")",stroke:"hsl("+h+",15%,75%)","stroke-width":4}),E.appendChild(Y);var H=this.circleVolume=s("circle");if(l(H,{cx:498,cy:76,r:22,fill:"url(#gradBtn"+n+")",stroke:"hsl("+h+",15%,50%)","stroke-width":4,"class":"button"}),this.circleVolume.setAttributeNS(null,"cx",this.volume/127*340+230|0),E.appendChild(H),b.style.display=L.style.display=M.style.display=N.style.display=F.style.display=T.style.display=E.style.display="none",!e.underground){var q=t.getElementsByTagName("script"),W=q.item(q.length-1).parentNode;W.appendChild(r)}r.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),r.addEventListener("touchstart",this.onTouchStart.bind(this)),window.addEventListener("touchmove",this.onTouchMove.bind(this)),window.addEventListener("touchend",this.onMouseUp.bind(this)),this.hasPlayedOnce=!1,this.isChangingVol=!1,this.hasReplacedFonts=!1,this.replaceFonts(),d.push(this)}var o=1,a=2,h=3,r=4,p=5,d=[];return n.prototype.setMasterVolume=function(t){var e;if(void 0===t?t=this.volume:this.volume=t,this.logVolume){var i=40,s=1/i;e=(Math.pow(i,t/127-1)-s)/(1-s)*127}else e=t;this.hasPlayedOnce&&this.flmml.setMasterVolume(e)},n.prototype.replaceFonts=function(){!this.hasReplacedFonts&&n.hasLoadedFonts&&(l(this.textDisplay,{y:45,"font-family":"'Press Start 2P'","font-weight":"normal","font-size":33}),this.hasReplacedFonts=!0)},n.prototype.getSVGPos=function(t,e){var i=this.svg.createSVGPoint();i.x=t,i.y=e;var s=i.matrixTransform(this.svg.getScreenCTM().inverse());return s},n.prototype.changeStatus=function(i,s){e(this.textDisplay),this.textDisplay.appendChild(t.createTextNode(i)),s&&this.textDisplay.setAttributeNS(null,"textLength",s)},n.prototype.showVolume=function(){for(var t=(0|this.volume)+"";t.length<3;)t=" "+t;this.changeStatus("Volume:"+t,289),this.isDispVol=!0,clearTimeout(this.tIDDispVol),this.tIDDispVol=setTimeout(this.onDispVolTimer.bind(this),2e3)},n.prototype.changeVolume=function(t){var e;230>t?e=0:t>=230&&570>t?e=(t-230)/340*127:t>=570&&(e=127),this.flmml&&(this.setMasterVolume(e),this.showVolume()),225>t&&(t=225),t>575&&(t=575),this.circleVolume.setAttributeNS(null,"cx",t)},n.prototype.onReadyStateChange=function(t){this.xhr.readyState===XMLHttpRequest.DONE&&(200===this.xhr.status?(this.changeStatus("Compiling...",347),this.gStop.style.display="inline",this.gStopD.style.display="none",this.mml=this.xhr.responseText,this.mmlStatus=r,this.flmml.play(this.mml),clearTimeout(this.tIDDispVol)):(this.changeStatus("Failure.",232),this.flmml.release(),this.flmml=null,this.mmlStatus=p))},n.prototype.onPlayFirst=function(){this.hasPlayedOnce=!0;var t=this.flmml=new FlMMLonHTML5(this.workerURL);this.setMasterVolume(),t.addEventListener("compilecomplete",this.onCompileComplete.bind(this)),t.addEventListener("buffering",this.onBuffering.bind(this)),t.addEventListener("complete",this.onComplete.bind(this)),t.addEventListener("syncinfo",this.onSyncInfo.bind(this));var e=this.svg;if(this.gPlayD.style.display=this.gDisplay.style.display=this.gVolume.style.display="inline",this.mmlStatus===o)this.changeStatus("Compiling...",347),this.gStop.style.display="inline",t.play(this.mml);else if(this.mmlStatus===a){var i=this.xhr=new XMLHttpRequest;i.addEventListener("readystatechange",this.onReadyStateChange.bind(this)),i.open("GET",this.mmlURL),i.send(null),this.mmlStatus=h,this.changeStatus("Loading...",289),this.gStopD.style.display="inline"}e.removeChild(this.gPlayFirst),e.appendChild(this.gPlay),e.appendChild(this.gPlayD),e.appendChild(this.gPause),e.appendChild(this.gStop),e.appendChild(this.gStopD),e.appendChild(this.gDisplay),e.appendChild(this.gVolume)},n.prototype.onPlayPause=function(){this.flmml.isPlaying()?(this.gPlay.style.display="inline",this.gPause.style.display="none",this.flmml.pause()):(this.gPlay.style.display=this.gStopD.style.display="none",this.gPause.style.display=this.gStop.style.display="inline",this.flmml.isPaused()||(this.isCompiling=!0,this.changeStatus("Compiling...",347)),this.flmml.play(this.mml)),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onStop=function(){this.gPlay.style.display=this.gStopD.style.display="inline",this.gPause.style.display=this.gStop.style.display="none",this.flmml.stop(),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onMouseDown=function(t){if(1&t.buttons&&this.hasPlayedOnce){var e=this.getSVGPos(t.clientX,t.clientY);e.x>=205&&e.x<595&&e.y>=50&&e.y<100&&(this.changeVolume(e.x),this.isChangingVol=!0)}},n.prototype.onMouseMove=function(t){if(1&t.buttons&&this.isChangingVol){var e=this.getSVGPos(t.clientX,t.clientY);this.changeVolume(e.x),t.preventDefault()}},n.prototype.onMouseUp=function(t){this.isChangingVol=!1},n.prototype.onTouchStart=function(t){if(this.hasPlayedOnce){var e=t.touches[0],i=this.getSVGPos(e.clientX,e.clientY);i.x>=205&&i.x<595&&i.y>=50&&i.y<100&&(this.changeVolume(i.x),this.isChangingVol=!0)}},n.prototype.onTouchMove=function(t){if(this.isChangingVol){var e=t.touches[0],i=this.getSVGPos(e.clientX,e.clientY);this.changeVolume(i.x),t.preventDefault()}},n.prototype.onCompileComplete=function(){this.gPause.style.display="inline",this.gPlayD.style.display="none",this.isCompiling=!1},n.prototype.onBuffering=function(t){100===t.progress?(this.isBuffering=!1,clearTimeout(this.tIDDispVol),this.onDispVolTimer()):this.isDispVol||(this.changeStatus("Buffering:"+(t.progress<10?" ":"")+t.progress+"%",377),this.isBuffering=!0)},n.prototype.onComplete=function(){this.gPlay.style.display=this.gStopD.style.display="inline",this.gPause.style.display=this.gStop.style.display="none",clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onSyncInfo=function(){this.isDispVol||this.isCompiling||this.isBuffering||this.changeStatus(this.flmml.getNowTimeStr()+"/"+this.flmml.getTotalTimeStr(),318)},n.prototype.onDispVolTimer=function(){this.isDispVol=!1,this.isCompiling?this.changeStatus("Compiling...",347):this.isBuffering||this.onSyncInfo()},n.prototype.getElement=function(){return this.svg},n.onActiveFonts=function(){n.hasLoadedFonts=!0;for(var t=d.length;t--;)d[t].replaceFonts.call(d[t])},n}(document),WebFontConfig={google:{families:["Press+Start+2P::latin"]},active:FlMMLPlayer.onActiveFonts};!function(){var t=document.createElement("script");t.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script").item(0);e.parentNode.insertBefore(t,e)}();