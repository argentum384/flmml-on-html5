"use strict";var FlMMLPlayer=function(w,b){var M=[];function C(t,i,e){t.addEventListener(i,e)}function T(t,i){t.appendChild(i)}function L(t){return t.cloneNode()}function k(t){return b.createElementNS("http://www.w3.org/2000/svg",t)}function B(t,i,e){t.setAttributeNS(null,i,e)}function F(t,i){for(var e in i)t.setAttributeNS(null,e,i[e])}function G(){for(var t=arguments.length;t--;)arguments[t].style.display="inline"}function N(){for(var t=arguments.length;t--;)arguments[t].style.display="none"}function R(t){1&t.buttons&&t.preventDefault()}function i(t){var i=this.no=M.length,e=this.hue=null==t.hue?200:t.hue;this.volume=null==t.volume?100:t.volume,this.logVolume=!!t.logVolume,this.workerURL=t.workerURL,t.mmlURL&&""!==t.mmlURL?(this.mmlURL=t.mmlURL,this.mmlStatus=2):(this.mml=t.mml,this.mmlStatus=1);var s=this.svg=k("svg");F(s,{id:"flmmlplayer"+i,viewBox:"0 0 600 100"}),s.style.height=t.height||"1.5em",C(s,"mousedown",R),C(s,"mousemove",R);var o=b.createElement("style");o.setAttribute("type","text/css"),T(o,b.createTextNode("svg#flmmlplayer"+i+" .clickable-button:active{fill:url(#gradBtnPushed"+i+");}svg#flmmlplayer"+i+" .clickable-button:hover{stroke:hsl("+e+",100%,75%)}svg#flmmlplayer"+i+" text{text-anchor:middle;pointer-events:none}")),T(s,o);var n=k("defs"),l=k("filter"),h=k("feGaussianBlur"),a=k("feMerge"),r=k("feMergeNode"),u=k("feMergeNode");F(l,{id:"filterGlow"+i,x:"-150%",y:"-100%",width:"600%",height:"400%"}),F(h,{in:"SourceGraphic",stdDeviation:8,result:"blur"}),B(r,"in","blur"),B(u,"in","SourceGraphic"),T(a,r),T(a,u),T(l,h),T(l,a),T(n,l);var c=k("linearGradient"),m=k("linearGradient"),g=k("stop"),f=k("stop");F(c,{id:"gradBtn"+i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),F(g,{offset:0,"stop-color":"hsl("+e+",30%,98%)"}),F(f,{offset:1,"stop-color":"hsl("+e+",30%,83%)"}),T(c,g),T(c,f),F(m,{id:"gradBtnPushed"+i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),f=L(f),g=L(g),B(f,"offset",0),B(g,"offset",1),T(m,f),T(m,g),T(n,c),T(n,m);var p=k("linearGradient"),d=k("stop"),v=k("stop");F(p,{id:"gradDisp"+i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),F(d,{offset:0,"stop-color":"hsl("+e+",100%,2%)"}),F(v,{offset:1,"stop-color":"hsl("+e+",100%,30%)"}),T(p,d),T(p,v),T(n,p),T(s,n);var y=this.gPlayFirst=k("g");C(y,"click",this.playFirst.bind(this));var x=this.rectBtn=k("rect");F(x,{x:5,y:5,width:90,height:90,rx:6,ry:6,fill:"url(#gradBtn"+i+")",stroke:"hsl("+e+",15%,50%)","stroke-width":4,class:"clickable-button"});var S=L(x);B(S,"width",590),T(y,S);var V=this.pathPlay=k("path");F(V,{fill:"hsl(120,100%,35%)",d:"M22,22v56l56,-28z",filter:"url(#filterGlow"+i+")","pointer-events":"none"});var D=L(V);B(D,"transform","translate(115,0)");var P=k("text");if(F(P,{x:345,y:72,"font-family":"'Verdana'","font-size":62,textLength:280}),T(P,b.createTextNode("Play MML")),T(y,P),T(y,D),T(s,y),!t.underground){var w=b.getElementsByTagName("script");T(w.item(w.length-1).parentNode,s)}this.hasPlayedOnce=!1,this.isChangingVol=!1,this.hasReplacedFonts=!1,M.push(this)}return function(t,i){for(var e in i)t[e]=i[e]}(i.prototype,{setMasterVolume:function(t){var i;if(null==t?t=this.volume:this.volume=t,this.logVolume){i=(Math.pow(40,t/127-1)-.025)/.975*127}else i=t;this.hasPlayedOnce&&this.flmml.setMasterVolume(i)},replaceFonts:function(){this.hasPlayedOnce&&!this.hasReplacedFonts&&i.hasLoadedFonts&&(F(this.textDisplay,{y:45,"font-family":"'Press Start 2P'","font-weight":"normal","font-size":33}),this.hasReplacedFonts=!0)},getSVGPos:function(t,i){var e=this.svg.createSVGPoint();return e.x=t,e.y=i,e.matrixTransform(this.svg.getScreenCTM().inverse())},changeStatus:function(t,i){for(var e,s=this.textDisplay;e=s.lastChild;)s.removeChild(e);T(s,b.createTextNode(t)),i&&B(s,"textLength",i)},showVolume:function(){for(var t=(0|this.volume)+"";t.length<3;)t=" "+t;this.changeStatus("Volume:"+t,289),this.isDispVol=!0,clearTimeout(this.tIDDispVol),this.tIDDispVol=setTimeout(this.onDispVolTimer.bind(this),2e3)},changeVolume:function(t){var i;t<230?i=0:230<=t&&t<570?i=(t-230)/340*127:570<=t&&(i=127),this.flmml&&(this.setMasterVolume(i),this.showVolume()),t<225&&(t=225),575<t&&(t=575),B(this.circleVolume,"cx",t)},onReadyStateChange:function(t){this.xhr.readyState===XMLHttpRequest.DONE&&(200===this.xhr.status?(this.changeStatus("Compiling...",347),G(this.gStop),N(this.gStopD),this.mml=this.xhr.responseText,this.mmlStatus=4,this.flmml.play(this.mml),clearTimeout(this.tIDDispVol)):(this.changeStatus("Failure.",232),this.flmml.release(),this.flmml=null,this.mmlStatus=5))},playFirst:function(){var t=this.flmml=new FlMMLonHTML5(this.workerURL);this.setMasterVolume(),C(t,"compilecomplete",this.onCompileComplete.bind(this)),C(t,"buffering",this.onBuffering.bind(this)),C(t,"complete",this.onComplete.bind(this)),C(t,"syncinfo",this.onSyncInfo.bind(this));var i=this.svg,e=this.no,s=this.hue,o=this.gPlay=k("g"),n=this.gPlayD=k("g"),l=this.gPause=k("g"),h=this.gStop=k("g"),a=this.gDisplay=k("g"),r=this.gVolume=k("g");C(o,"click",this.playPause.bind(this)),C(l,"click",this.playPause.bind(this)),B(h,"transform","translate(100,0)"),C(h,"click",this.stop.bind(this));var u=this.gStopD=L(h),c=this.rectBtn;T(o,L(c)),T(l,L(c)),T(h,L(c));var m=L(c);F(m,{stroke:"hsl("+s+",15%,75%)",class:""}),T(n,L(m)),T(u,L(m));var g=this.pathPlay;T(o,g);var f=L(g);F(f,{fill:"gray",opacity:.5}),T(n,f);var p=k("rect");F(p,{x:26,y:22,width:17,height:56,fill:"hsl(210,100%,50%)",filter:"url(#filterGlow"+e+")","pointer-events":"none"});var d=L(p);B(d,"x",57),T(l,p),T(l,d);var v=k("rect");F(v,{x:23,y:23,width:54,height:54,fill:"hsl(15,100%,50%)",filter:"url(#filterGlow"+e+")","pointer-events":"none"}),T(h,v);var y=L(v);F(y,{fill:"gray",opacity:.5}),T(u,y);var x=k("rect");F(x,{x:203,y:5,width:394,height:44,rx:6,ry:6,fill:"url(#gradDisp"+e+")",stroke:"hsl("+s+",100%,30%)","stroke-width":4,"pointer-events":"none"}),T(a,x);var S=this.textDisplay=k("text");F(S,{x:401,y:43,fill:"white","font-family":"'Courier New',Courier',monospace","font-weight":"bold","font-size":50}),T(a,S);var V=k("rect");F(V,{x:205,y:70,width:390,height:12,rx:4,ry:4,fill:"url(#gradBtnPushed"+e+")",stroke:"hsl("+s+",15%,75%)","stroke-width":4}),T(r,V);var D=this.circleVolume=k("circle");if(F(D,{cx:498,cy:76,r:22,fill:"url(#gradBtn"+e+")",stroke:"hsl("+s+",15%,50%)","stroke-width":4,class:"button"}),B(D,"cx",this.volume/127*340+230|0),T(r,D),N(o,l,h,u),1===this.mmlStatus)this.changeStatus("Compiling...",347),G(h),t.play(this.mml);else if(2===this.mmlStatus){var P=this.xhr=new XMLHttpRequest;C(P,"readystatechange",this.onReadyStateChange.bind(this)),P.open("GET",this.mmlURL),P.send(null),this.mmlStatus=3,this.changeStatus("Loading...",289),G(u)}i.removeChild(this.gPlayFirst),T(i,o),T(i,n),T(i,l),T(i,h),T(i,u),T(i,a),T(i,r),C(i,"mousedown",this.onMouseDown.bind(this)),C(w,"mousemove",this.onMouseMove.bind(this)),C(w,"mouseup",this.onMouseUp.bind(this)),C(i,"touchstart",this.onTouchStart.bind(this)),C(w,"touchmove",this.onTouchMove.bind(this)),C(w,"touchend",this.onMouseUp.bind(this)),this.hasPlayedOnce=!0,this.replaceFonts()},playPause:function(){this.flmml.isPlaying()?(G(this.gPlay),N(this.gPause),this.flmml.pause()):(G(this.gPause,this.gStop),N(this.gPlay,this.gStopD),this.flmml.isPaused()||(this.isCompiling=!0,this.changeStatus("Compiling...",347)),this.flmml.play(this.mml)),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},stop:function(){G(this.gPlay,this.gStopD),N(this.gPause,this.gStop),this.flmml.stop(),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},onMouseDown:function(t){if(1&t.buttons&&this.hasPlayedOnce){var i=this.getSVGPos(t.clientX,t.clientY);205<=i.x&&i.x<595&&50<=i.y&&i.y<100&&(this.changeVolume(i.x),this.isChangingVol=!0)}},onMouseMove:function(t){if(1&t.buttons&&this.isChangingVol){var i=this.getSVGPos(t.clientX,t.clientY);this.changeVolume(i.x),t.preventDefault()}},onMouseUp:function(t){this.isChangingVol=!1},onTouchStart:function(t){if(this.hasPlayedOnce){var i=t.touches[0],e=this.getSVGPos(i.clientX,i.clientY);205<=e.x&&e.x<595&&50<=e.y&&e.y<100&&(this.changeVolume(e.x),this.isChangingVol=!0)}},onTouchMove:function(t){if(this.isChangingVol){var i=t.touches[0],e=this.getSVGPos(i.clientX,i.clientY);this.changeVolume(e.x),t.preventDefault()}},onCompileComplete:function(){G(this.gPause),N(this.gPlayD),this.isCompiling=!1},onBuffering:function(t){100===t.progress?(this.isBuffering=!1,clearTimeout(this.tIDDispVol),this.onDispVolTimer()):this.isDispVol||(this.changeStatus("Buffering:"+(t.progress<10?" ":"")+t.progress+"%",377),this.isBuffering=!0)},onComplete:function(){G(this.gPlay,this.gStopD),N(this.gPause,this.gStop),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},onSyncInfo:function(){this.isDispVol||this.isCompiling||this.isBuffering||this.changeStatus(this.flmml.getNowTimeStr()+"/"+this.flmml.getTotalTimeStr(),318)},onDispVolTimer:function(){this.isDispVol=!1,this.isCompiling?this.changeStatus("Compiling...",347):this.isBuffering||this.onSyncInfo()},getElement:function(){return this.svg}}),i.onActiveFonts=function(){i.hasLoadedFonts=!0;for(var t=M.length;t--;)M[t].replaceFonts.call(M[t])},i.hasLoadedFonts=!1,i}(window,document),WebFontConfig={google:{families:["Press+Start+2P::latin"]},active:FlMMLPlayer.onActiveFonts};!function(t){var i=t.createElement("script");i.src=("https:"===t.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",i.type="text/javascript",i.async="true";var e=t.getElementsByTagName("script").item(0);e.parentNode.insertBefore(i,e)}(document);