"use strict";var FlMMLPlayer=function(t){function i(t){for(var i;i=t.lastChild;)t.removeChild(i)}function e(){var i,e,n,l,A;e=t.createElement("button"),i=e.style,i.margin="0",i.position="relative",i.width=i.height="20px",i.visibility="hidden",n=t.createElement("div"),i=n.style,i.position="absolute",i.left=i.top="0",i.width=i.height="20px",e.appendChild(n),t.body.appendChild(e),l=e.getBoundingClientRect(),A=n.getBoundingClientRect(),s=l.left-A.left,o=l.top-A.top,t.body.removeChild(e)}function n(i){var n;if(i.mmlURL&&""!==i.mmlURL){var a=this.xhr=new XMLHttpRequest;a.addEventListener("readystatechange",this.onReadyStateChange.bind(this)),a.open("GET",i.mmlURL),a.send(null),this.mmlStatus=A}else this.mml=i.mml,this.mmlStatus=l;(void 0===s||void 0===o)&&e();var h=this.divContainer=t.createElement("div");n=h.style,n.display="inline-block",n.position="relative",n.left=n.top="0",n.width="128px",n.height="20px",n.color="black",n.textAlign="center",n.fontSize="12px",n.fontFamily="'Arial', sans-serif",n.zIndex="0";var m=this.btnPlayPause=t.createElement("button");n=m.style,n.margin="0",n.position="absolute",n.left=n.top="0",n.width=n.height="20px",m.addEventListener("click",this.onPlayPause.bind(this));var r=this.btnPlayMML=m.cloneNode();r.style.width="128px",r.addEventListener("click",this.onPlayFirst.bind(this));var g=this.btnStop=m.cloneNode();g.style.left="20px",g.addEventListener("click",this.onStop.bind(this));var f=this.btnVolume=m.cloneNode();f.style.left="",f.style.right="0",f.addEventListener("click",this.onVolume.bind(this));var u=this.imgPause=t.createElement("img");u.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAUVBMVEUAgf8Agv0AdvwAf/0AgP8Afv4AgPsAgP8Akf8Af/8AfvwAfv8Af/8AffoAfv8Af/0Afv8Agf8AgP0AgP8Agf8Agv8AgP0Aff0Agf8Afv8Af/5GU6gfAAAAGnRSTlMQCgZFLxwVDAJfQDgqHhigJyOWiFErdnZZWQOnFfsAAACjSURBVBjTbZFLDsMgDERtEzDhl5Bv2/sftDaq2i48i5H8JMwwQIxEyPARI1GMIIwheO9rFQvARAo5+H5OQ2f3gQUSgi85uaGUSwUkIGhrfonmWT2vTRBCnZyO963upioIQ8+HjvuufuQeFK7pqeO2qT/SKpBbSWPbsozNqTQGbMX9Q1caWtA+bl1kR/qFv65vePOZZiFmdQJxlFxFo2SkaH7HG2/2EtuThcAOAAAAAElFTkSuQmCC",n=u.style,n.marginLeft=n.marginRight=s+"px",n.marginTop=n.marginBottom=o+"px",n.position="absolute",n.left=n.top="0",n.width=n.height="20px";var v=this.imgPlay=u.cloneNode();v.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAASFBMVEUAAAAAmgAAlQAAlwAAmAAAmQAAmgAAlwAAmwAAmQAAmQAAmQAAmAAAmQAAmQAAmAAAlwAAmQAAmQAAmAAAlwAAmQAAmQAAmADD6lrGAAAAF3RSTlMABwQKGRUNJRE5IC9UKkRqYE9ANXNkRrSOT5UAAACQSURBVBjTbZFbEsMgCEV9oIivxKQt+99p0cm0fnA+z1xHuBjjrPWCtc6ZB3E+phBSiv6vrU+QETHDpsVhIaK7ZQiil42AN3Oto1NBSa9wyqWzcJy1U8shzmxAqrx4neMqy4q8Tn446rTeGmj9zT8GNYhTfg7eKJBUqT9XP1JH0oZX11QL2atbyu0lh71k9Rxfym0PdbeElC0AAAAASUVORK5CYII=",v.style.left="25px";var y=this.imgStop=u.cloneNode();y.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAPFBMVEX+AD7/AD//AED/AEn+AD//AD/+AD/+AEH/ADn9ADv/AE3+AD79AD7/AD7/AED+AD7/AED8AD7/AD7+AD9mm+jzAAAAE3RSTlMqFhIIaUY9Hw0ZA1lOQjQmLWNiJUEu2wAAAINJREFUGNNtkUsOwzAIRMdgg/920vvftSiL1lJ47J6EgAG1Mmei8ECUmWtFNVV04WFpMV3BOSimjGQMmdCQGUy6pbcrGlfrspUYuUA+B4KSQTr7KftUAi1pp2yyCAHjPuU9EKxSPGVMpspbFle67e4gdyV3efdMNxA3un/Ie/9Cdt/xBc2vEO2zvZ1rAAAAAElFTkSuQmCC";var c=this.imgVolume=u.cloneNode();c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAS1BMVEV+fgB+fgB9fQB+fgB+fgCAgAB+fgB+fgB5eQB+fgB/fwCAgACPjwB+fgB9fQB8fAB9fQCIiAB+fgB+fgB9fQB+fgB/fwCAgAB+fgDkkneCAAAAGHRSTlMVLykkHRlGNg47IQoEXU0RPwd8aVVRhT4xQnacAAAAkklEQVQY04XR2w7DIAgGYASVauthW7vx/k+6v+mW7IJk3PkFEJG2bbuty6AUq4jUmGhZgTCQcEAYVyjBkFY5aJnTLEAHnRYl6Cv3w8xKkESEWljJfW+GyMqR6GNHe9gZfSIVWFlxusz2rMCRJEyc7hc21KNpZM0/2AuafvH5D91y7yJ/JHd495nuQtzVuUt2v+MNB6QSU7F5AiUAAAAASUVORK5CYII=";var b=this.divDisplay=t.createElement("div");n=b.style,n.position="absolute",n.left="40px",n.top="0",n.width="68px",n.height="20px",n.backgroundColor=p,n.boxSizing="border-box",n.border=d;var C=this.divStatus=t.createElement("div");n=C.style,n.marginLeft=n.marginRight="-1px",n.marginTop="-0.5em",n.position="absolute",n.top="9px",n.width="68px",n.fontSize="10px";var S=this.divPlayMML=t.createElement("div");n=S.style,n.marginLeft=n.marginRight=s+"px",n.marginTop="-0.5em",n.position="absolute",n.left="45px",n.top="50%",n.fontSize="12px",S.appendChild(t.createTextNode("Play MML"));var x=this.divVolume=t.createElement("div");n=x.style,n.position="absolute",n.width="88px",n.visibility="hidden",n.backgroundColor=p,n.boxSizing="border-box",n.border=d,n.zIndex="1";var E=this.rangeVolume=t.createElement("input");E.type="range",E.defaultValue=void 0===i.volume?"100":i.volume+"",E.min="0",E.max="127",E.step="1",n=E.style,n.marginLeft=n.marginRight="0",n.marginTop=n.marginBottom="-1px",n.padding="0",n.left=n.top="0",n.position="absolute",n.width="86px",E.addEventListener("input",this.onInput.bind(this)),r.appendChild(v),r.appendChild(S),m.appendChild(u),g.appendChild(y),f.appendChild(c),b.appendChild(C),this.mmlStatus===l&&h.appendChild(r),x.appendChild(E);var V=t.getElementsByTagName("script"),B=V[V.length-1].parentNode;B.appendChild(h),B.appendChild(x);var P=this.flmml=new FlMMLonHTML5(i.workerURL);P.addEventListener("compilecomplete",this.onCompileComplete.bind(this)),P.addEventListener("buffering",this.onBuffering.bind(this)),P.addEventListener("complete",this.onComplete.bind(this)),P.addEventListener("syncinfo",this.onSyncInfo.bind(this)),void 0!==i.volume&&P.setMasterVolume(i.volume)}var s,o,l=1,A=2,a=3,h=4,p="RGBA(255,255,255,0.6)",d="1px inset RGBA(255,255,255,0.8)";return n.prototype.changeStatus=function(e){i(this.divStatus),this.divStatus.appendChild(t.createTextNode(e))},n.prototype.showVolume=function(){this.changeStatus("Volume:"+this.rangeVolume.value),this.isDispVol=!0,clearTimeout(this.tIDDispVol),this.tIDDispVol=setTimeout(this.onDispVolTimer.bind(this),2e3)},n.prototype.onReadyStateChange=function(i){if(this.xhr.readyState===XMLHttpRequest.DONE)if(200===this.xhr.status)this.mml=this.xhr.responseText,this.divContainer.appendChild(this.btnPlayMML),this.mmlStatus=a;else{var e=this.divContainer.style;e.backgroundColor=p,e.boxSizing="border-box",e.border=d;var n=t.createElement("div");e=n.style,e.marginLeft=e.marginRight="-1px",e.marginTop="-0.5em",e.position="absolute",e.top="9px",e.width="128px",n.appendChild(t.createTextNode("Can't load the file.")),this.divContainer.appendChild(n),this.flmml=null,this.mmlStatus=h}},n.prototype.onPlayFirst=function(){var t=this.divContainer;t.removeChild(this.btnPlayMML),this.btnPlayMML.removeChild(this.imgPlay),this.imgPlay.style.left="0",this.changeStatus("Compiling..."),t.appendChild(this.btnPlayPause),t.appendChild(this.btnStop),t.appendChild(this.divDisplay),t.appendChild(this.btnVolume),this.flmml.play(this.mml)},n.prototype.onPlayPause=function(){i(this.btnPlayPause),this.flmml.isPlaying()?(this.btnPlayPause.appendChild(this.imgPlay),this.flmml.pause()):(this.btnPlayPause.appendChild(this.imgPause),this.flmml.isPaused()||(this.isCompiling=!0,this.changeStatus("Compiling...")),this.flmml.play(this.mml)),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onStop=function(){i(this.btnPlayPause),this.btnPlayPause.appendChild(this.imgPlay),this.btnStop.disabled="disabled",this.imgStop.style.opacity="0.4",this.flmml.stop(),clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onVolume=function(){var t,i,e,n;t=this.divVolume.style,"hidden"===t.visibility?(t.left=t.top="0",i=this.divContainer.getBoundingClientRect(),e=this.divVolume.getBoundingClientRect(),n=this.rangeVolume.getBoundingClientRect(),t.left=(i.left-e.left+40).toFixed(1)+"px",t.top=(i.top-e.top+20).toFixed(1)+"px",t.height=(n.bottom-n.top).toFixed(1)+"px",t.visibility="visible",this.showVolume()):"visible"===t.visibility&&(t.visibility="hidden")},n.prototype.onInput=function(){this.flmml.setMasterVolume(parseInt(this.rangeVolume.value)),this.showVolume()},n.prototype.onCompileComplete=function(){this.btnStop.disabled="",this.imgStop.style.opacity="1.0",this.isCompiling=!1},n.prototype.onBuffering=function(t){100===t.progress?this.isBuffering=!1:(this.changeStatus("Buffering:"+t.progress+"%"),this.isBuffering=!0)},n.prototype.onComplete=function(){i(this.btnPlayPause),btnPlayPause.appendChild(this.imgPlay),this.btnStop.disabled="disabled",this.imgStop.style.opacity="0.4",clearTimeout(this.tIDDispVol),this.onDispVolTimer()},n.prototype.onSyncInfo=function(){this.isDispVol||this.isCompiling||this.isBuffering||this.changeStatus(this.flmml.getNowTimeStr()+"/"+this.flmml.getTotalTimeStr())},n.prototype.onDispVolTimer=function(){this.isDispVol=!1,this.onSyncInfo()},n}(document);