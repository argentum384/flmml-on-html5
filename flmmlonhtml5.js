/*! FlMMLonHTML5 v1.1.2 | (c) 2018, carborane3 | BSD-3-Clause | https://github.com/carborane3/FlMMLonHTML5 */
"use strict";var FlMMLonHTML5=function(){var i,n=8192,s=1,r=new Float32Array(n);function o(t,e){for(var i in e)t[i]=e[i];return t}function a(t){t||(t="FlMMLonHTML5"===a.name?"flmmlworker-raw.js":"flmmlworker.js");var e=this.worker=new Worker(t);e.addEventListener("message",this.onMessage.bind(this)),this.onAudioProcessBinded=this.onAudioProcess.bind(this),this.warnings="",this.totalTimeStr="00:00",this.bufferReady=!1,this.volume=100,this.events={},e.postMessage({type:s,sampleRate:a.audioCtx.sampleRate,bufferSize:n}),this.setInfoInterval(125)}o(a.prototype,{onMessage:function(t){var e=t.data;switch(e.type){case 5:this.buffer=e.buffer,this.bufferReady=!0;break;case 6:o(this,e.info),this.oncompilecomplete&&this.oncompilecomplete(),this.trigger("compilecomplete");break;case 7:this.onbuffering&&this.onbuffering(e),this.trigger("buffering",e);break;case 8:this.oncomplete&&this.oncomplete(),this.trigger("complete");break;case 9:o(this,e.info),this.onsyncinfo&&this.onsyncinfo(),this.trigger("syncinfo");break;case 10:this.playSound();break;case 11:this.stopSound(e.isFlushBuf),this.worker.postMessage({type:11});break;case 12:!function(t){i||(i=document.createElement("div"),document.body.appendChild(i));var e=document.createElement("div");e.appendChild(document.createTextNode(t)),i.appendChild(e),10<i.getElementsByTagName("div").length&&i.removeChild(i.firstChild)}(e.str)}},playSound:function(){if(!(this.gain||this.scrProc||this.oscDmy)){var t=a.audioCtx,e=this.gain=t.createGain();e.gain.value=this.volume/127,e.connect(t.destination),this.scrProc=t.createScriptProcessor(n,1,2),this.scrProc.addEventListener("audioprocess",this.onAudioProcessBinded),this.scrProc.connect(this.gain),this.oscDmy=t.createOscillator(),this.oscDmy.connect(this.scrProc),this.oscDmy.start(0)}},stopSound:function(t){t&&(this.bufferReady=!1),(this.gain||this.scrProc||this.oscDmy)&&(this.scrProc.removeEventListener("audioprocess",this.onAudioProcessBinded),this.gain&&(this.gain.disconnect(),this.gain=null),this.scrProc&&(this.scrProc.disconnect(),this.scrProc=null),this.oscDmy&&(this.oscDmy.disconnect(),this.oscDmy=null))},onAudioProcess:function(t){var e=t.outputBuffer;this.bufferReady?(e.getChannelData(0).set(this.buffer[0]),e.getChannelData(1).set(this.buffer[1]),this.bufferReady=!1,this.worker.postMessage({type:5,retBuf:this.buffer},[this.buffer[0].buffer,this.buffer[1].buffer])):(e.getChannelData(0).set(r),e.getChannelData(1).set(r),this.worker.postMessage({type:5,retBuf:null}))},trigger:function(t,e){var i=this.events[t];if(i){var n={};o(n,e);for(var s=0,r=i.length;s<r;s++)i[s]&&i[s].call(this,n)}},play:function(t){this.worker.postMessage({type:2,mml:t})},stop:function(){this.worker.postMessage({type:3})},pause:function(){this.worker.postMessage({type:4})},setMasterVolume:function(t){this.volume=t,this.gain&&(this.gain.gain.value=this.volume/127)},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},getWarnings:function(){return this.warnings},getTotalMSec:function(){return 0|this.totalMSec},getTotalTimeStr:function(){return this.totalTimeStr},getNowMSec:function(){return 0|this.nowMSec},getNowTimeStr:function(){return this.nowTimeStr},getVoiceCount:function(){return this.voiceCount},getMetaTitle:function(){return this.metaTitle},getMetaComment:function(){return this.metaComment},getMetaArtist:function(){return this.metaArtist},getMetaCoding:function(){return this.metaCoding},setInfoInterval:function(t){this.worker.postMessage({type:9,interval:t})},syncInfo:function(){this.worker.postMessage({type:9,interval:null})},addEventListener:function(t,e){var i=this.events[t];i||(i=this.events[t]=[]);for(var n=i.length;n--;)if(i[n]===e)return!1;return i.push(e),!0},removeEventListener:function(t,e){var i=this.events[t];if(!i)return!1;for(var n=i.length;n--;)if(i[n]===e)return i.splice(n,1),!0;return!1},release:function(){this.stopSound(),this.worker.terminate()}});var t=window.AudioContext||window.webkitAudioContext;return a.audioCtx=new t,document.addEventListener("DOMContentLoaded",function(){window.addEventListener("click",function t(e){var i=a.audioCtx,n=i.createBufferSource();n.connect(i.destination),n.start(0),i.resume(),window.removeEventListener("click",t,!0)},!0)}),a}();